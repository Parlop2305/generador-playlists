<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Playlists</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button, input, select { padding: 10px; margin: 10px 0; width: 100%; font-size: 16px; }
    #playlistLink { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ðŸŽµ Generador de Playlist</h1>

  <label>Artista favorito:</label>
  <input type="text" id="artist" placeholder="Ej: Bad Bunny">

  <button id="authBtn">ðŸ”‘ Iniciar sesiÃ³n con Google</button>
  <button id="spotifyBtn">ðŸŸ¢ Iniciar sesiÃ³n con Spotify</button>

  <button id="generateBtn" disabled>ðŸŽ¶ Crear Playlist (Google)</button>

  <div id="playlistLink"></div>

  <script>
    // === CONFIGURACIÃ“N GOOGLE ===
    const GOOGLE_CLIENT_ID = 'TU_CLIENT_ID_GOOGLE';
    const GOOGLE_REDIRECT_URI = 'https://parlop2305.github.io/generador-playlists/';
    const GOOGLE_SCOPES = 'https://www.googleapis.com/auth/youtube';
    const googleAuthURL =
      'https://accounts.google.com/o/oauth2/v2/auth' +
      '?client_id=' + GOOGLE_CLIENT_ID +
      '&redirect_uri=' + encodeURIComponent(GOOGLE_REDIRECT_URI) +
      '&response_type=token' +
      '&scope=' + encodeURIComponent(GOOGLE_SCOPES);

    // === CONFIGURACIÃ“N SPOTIFY ===
    const SPOTIFY_CLIENT_ID = 'TU_CLIENT_ID_SPOTIFY';
    const SPOTIFY_REDIRECT_URI = 'https://parlop2305.github.io/generador-playlists/';
    const SPOTIFY_SCOPES = [
      'playlist-modify-public',
      'playlist-modify-private',
      'user-read-private'
    ];
    const spotifyAuthURL =
      'https://accounts.spotify.com/authorize' +
      '?response_type=token' +
      '&client_id=' + SPOTIFY_CLIENT_ID +
      '&redirect_uri=' + encodeURIComponent(SPOTIFY_REDIRECT_URI) +
      '&scope=' + encodeURIComponent(SPOTIFY_SCOPES.join(' '));

    let googleToken = null;
    let spotifyToken = null;

    // === BOTONES DE AUTENTICACIÃ“N ===
    document.getElementById("authBtn").onclick = () => {
      localStorage.setItem("authSource", "google");
      window.location.href = googleAuthURL;
    };

    document.getElementById("spotifyBtn").onclick = () => {
      localStorage.setItem("authSource", "spotify");
      window.location.href = spotifyAuthURL;
    };

    // === MANEJAR EL TOKEN AL VOLVER DEL LOGIN ===
    window.addEventListener('load', function () {
      const hash = window.location.hash;

      if (hash.includes('access_token')) {
        const token = new URLSearchParams(hash.substring(1)).get('access_token');
        const source = localStorage.getItem("authSource");

        if (source === "google") {
          googleToken = token;
          document.getElementById("generateBtn").disabled = false;
          console.log("Google token:", googleToken);
        } else if (source === "spotify") {
          spotifyToken = token;
          alert("SesiÃ³n iniciada con Spotify. AÃºn no vinculada la creaciÃ³n de playlist.");
          console.log("Spotify token:", spotifyToken);
        }

        // Limpia el hash de la URL por seguridad
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });

    // === CREAR PLAYLIST EN YOUTUBE (solo de prueba)
    document.getElementById("generateBtn").onclick = async () => {
      const artist = document.getElementById("artist").value;
      const query = `${artist} top hits`;

      const videoId = await searchVideo(query);
      const playlistId = await createPlaylist(`Playlist de ${artist}`);
      await addVideoToPlaylist(playlistId, videoId);

      document.getElementById("playlistLink").innerHTML =
        `âœ… Playlist creada en YouTube: <a href="https://www.youtube.com/playlist?list=${playlistId}" target="_blank">Ver</a>`;
    };

    async function searchVideo(query) {
      const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&maxResults=1`, {
        headers: { Authorization: `Bearer ${googleToken}` }
      });
      const data = await res.json();
      return data.items?.[0]?.id?.videoId || null;
    }

    async function createPlaylist(title) {
      const res = await fetch('https://www.googleapis.com/youtube/v3/playlists?part=snippet,status', {
        method: 'POST',
        headers: {
          Authorization: `Bearer ${googleToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          snippet: { title: title, description: 'Generado automÃ¡ticamente' },
          status: { privacyStatus: 'private' }
        })
      });
      const data = await res.json();
      return data.id;
    }

    async function addVideoToPlaylist(playlistId, videoId) {
      await fetch('https://www.googleapis.com/youtube/v3/playlistItems?part=snippet', {
        method: 'POST',
        headers: {
          Authorization: `Bearer ${googleToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          snippet: {
            playlistId: playlistId,
            resourceId: { kind: "youtube#video", videoId: videoId }
          }
        })
      });
    }
  </script>
</body>
</html>
